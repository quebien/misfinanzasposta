<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mis Finanzas Posta</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo">üí∞</span>
      <div>
        <h1>Mis Finanzas Posta</h1>
        <p>Control financiero que funciona posta</p>
      </div>
      <span class="pill" id="versionBadge"></span>
    </div>
    <div class="actions">
      <label class="toggle">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
        <span class="toggle-label">Tema oscuro</span>
      </label>
    </div>
  </header>

  <div id="message" class="toast hidden" role="status" aria-live="polite"></div>

  <nav class="tabs">
    <button class="tab active" data-target="dashboard">Resumen</button>
    <button class="tab" data-target="add">Nuevo</button>
    <button class="tab" data-target="monthly">Mes a Mes</button>
    <button class="tab" data-target="search">Buscador</button>
    <button class="tab" data-target="charts">Gr√°ficos</button>
    <button class="tab" data-target="settings">Configuraci√≥n</button>
  </nav>

  <main>
    <section id="dashboard" class="panel active">
      <div class="panel-header">
        <div class="month-switch">
          <button id="prevMonth" aria-label="Mes anterior">‚óÄ</button>
          <h2 id="currentMonth"></h2>
          <button id="nextMonth" aria-label="Mes siguiente">‚ñ∂</button>
        </div>
        <div class="quick-stats">
          <div class="card income">
            <p>Ingresos</p>
            <h3 id="monthIncome">$0</h3>
          </div>
          <div class="card expense">
            <p>Gastos</p>
            <h3 id="monthExpense">$0</h3>
          </div>
          <div class="card balance">
            <p>Balance</p>
            <h3 id="monthBalance">$0</h3>
          </div>
        </div>
      </div>
      <div class="panel-content">
        <h3>√öltimos movimientos</h3>
        <ul id="recentList" class="list"></ul>
      </div>
    </section>

    <section id="add" class="panel">
      <div class="two-columns">
        <div>
          <h2 class="section-title expense-title">üí∏ Nuevo gasto</h2>
          <form id="expenseForm" class="form-card expense-card">
            <label>Descripci√≥n<input name="description" required></label>
            <label>Monto<input name="amount" type="number" step="0.01" required></label>
            <label>Fecha<input name="date" type="date" required></label>
            <label>Categor√≠a<select name="category" required></select></label>
            <label>Lote (opcional)<input name="batch" placeholder="Ej: Suscripci√≥n, colegio"></label>
            <label>Repetici√≥n<select name="repeat">
              <option value="none">No repite</option>
              <option value="monthly">Repite mes a mes</option>
              <option value="installments">Dividir en cuotas</option>
            </select></label>
            <label id="repeatCountLabel" class="optional">Cantidad de repeticiones/cuotas<input name="repeatCount" type="number" min="1" value="1"></label>
            <label>Notas<textarea name="notes" rows="2"></textarea></label>
            <button type="submit" class="btn-expense">Agregar gasto</button>
          </form>
        </div>
        <div>
          <h2 class="section-title income-title">üí∞ Nuevo ingreso</h2>
          <form id="incomeForm" class="form-card income-card">
            <label>Descripci√≥n<input name="description" required></label>
            <label>Monto<input name="amount" type="number" step="0.01" required></label>
            <label>Fecha<input name="date" type="date" required></label>
            <label>Categor√≠a<select name="category" required></select></label>
            <label>Lote (opcional)<input name="batch" placeholder="Ej: Suscripci√≥n, colegio"></label>
            <label>Repetici√≥n<select name="repeat">
              <option value="none">No repite</option>
              <option value="monthly">Repite mes a mes</option>
              <option value="installments">Dividir en cuotas</option>
            </select></label>
            <label id="repeatCountLabelIncome" class="optional">Cantidad de repeticiones/cuotas<input name="repeatCount" type="number" min="1" value="1"></label>
            <label>Notas<textarea name="notes" rows="2"></textarea></label>
            <button type="submit" class="btn-income">Agregar ingreso</button>
          </form>
        </div>
      </div>
    </section>

    <section id="monthly" class="panel">
      <div class="panel-header">
        <h2>Mes a mes</h2>
        <p>Totales hist√≥ricos y gr√°fico de tendencia</p>
      </div>
      <div class="panel-content">
        <form class="form-row">
          <label>Desde
            <input type="month" id="monthlyFrom" aria-label="Mes desde">
          </label>
          <label>Hasta
            <input type="month" id="monthlyTo" aria-label="Mes hasta">
          </label>
        </form>
        <canvas id="monthlyChart" height="140"></canvas>
        <div class="table-wrapper">
          <table class="monthly-table">
            <thead>
              <tr><th>Mes</th><th>Ingresos</th><th>Gastos</th><th>Balance</th></tr>
            </thead>
            <tbody id="monthlyTable"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="search" class="panel">
      <div class="panel-header">
        <h2>Buscador</h2>
        <p>Filtra por descripci√≥n, fecha y categor√≠a</p>
      </div>
      <form id="searchForm" class="form-row">
        <label class="search-input grow" aria-label="Descripci√≥n">
          <input name="text" type="search" placeholder="Descripci√≥n" aria-label="Descripci√≥n">
          <button type="button" id="clearSearchText" aria-label="Borrar b√∫squeda">‚úï</button>
        </label>
        <input name="from" type="date" aria-label="Desde">
        <input name="to" type="date" aria-label="Hasta">
        <select name="category" aria-label="Categor√≠a">
          <option value="">Todas</option>
        </select>
        <button type="submit">Buscar</button>
      </form>
      <div class="table-wrapper search-table">
        <table>
          <thead><tr><th>Fecha</th><th>Tipo</th><th>Descripci√≥n</th><th>Categor√≠a</th><th>Monto</th><th>Notas</th></tr></thead>
          <tbody id="searchResults"></tbody>
        </table>
      </div>

      <div id="entryEditor" class="form-card hidden">
        <div class="editor-header">
          <h3>Detalle de registro</h3>
          <div class="pill muted" id="editorId"></div>
        </div>
        <form id="editForm" class="form-row">
          <label>Tipo
            <select name="type" required>
              <option value="income">Ingreso</option>
              <option value="expense">Gasto</option>
            </select>
          </label>
          <label>Descripci√≥n<input name="description" required></label>
          <label>Monto<input name="amount" type="number" step="0.01" required></label>
          <label>Fecha<input name="date" type="date" required></label>
          <label>Categor√≠a<select name="category" required></select></label>
          <label>Lote (opcional)<input name="batch" placeholder="Ej: Suscripci√≥n deportiva"></label>
          <label>Notas<textarea name="notes" rows="2"></textarea></label>
          <div class="editor-actions">
            <button type="submit">Guardar cambios</button>
            <button type="button" id="deleteBatch" class="ghost danger hidden">Borrar lote</button>
            <button type="button" id="deleteEntry" class="ghost danger">Borrar</button>
          </div>
        </form>
      </div>
    </section>

    <section id="charts" class="panel">
      <div class="panel-header">
        <h2>Gr√°ficos y ranking</h2>
        <p>Selecciona un mes o rango para ver el ranking de categor√≠as</p>
      </div>
      <div class="form-row">
        <label>Modo
          <select id="rankingMode">
            <option value="month">Mes</option>
            <option value="range">Rango de fechas</option>
          </select>
        </label>
        <label id="monthPickerLabel">Mes
          <input type="month" id="rankingMonth">
        </label>
        <label id="rangeFromLabel" class="hidden">Desde
          <input type="date" id="rankingFrom">
        </label>
        <label id="rangeToLabel" class="hidden">Hasta
          <input type="date" id="rankingTo">
        </label>
      </div>
      <div class="two-columns">
        <div class="chart-card">
          <h3>Ranking gastos</h3>
          <canvas id="expenseRank"></canvas>
        </div>
        <div class="chart-card">
          <h3>Ranking ingresos</h3>
          <canvas id="incomeRank"></canvas>
        </div>
      </div>
    </section>

    <section id="settings" class="panel">
      <div class="panel-header">
        <h2>Configuraci√≥n</h2>
        <p>Personaliza categor√≠as y tema</p>
      </div>
      <div class="form-card">
        <h3>Categor√≠as de ingresos</h3>
        <div class="form-row">
          <label class="grow">Nueva categor√≠a
            <input id="newIncomeCategory" placeholder="Ej: Salario extra" aria-label="Nueva categor√≠a de ingreso">
          </label>
          <button type="button" id="addIncomeCategory">Agregar</button>
        </div>
        <div class="chip-list" id="incomeCategoryList"></div>
      </div>
      <div class="form-card">
        <h3>Categor√≠as de gastos</h3>
        <div class="form-row">
          <label class="grow">Nueva categor√≠a
            <input id="newExpenseCategory" placeholder="Ej: Transporte" aria-label="Nueva categor√≠a de gasto">
          </label>
          <button type="button" id="addExpenseCategory">Agregar</button>
        </div>
        <div class="chip-list" id="expenseCategoryList"></div>
      </div>
      <div class="form-card">
        <p>Tema actual: <strong id="themePreview"></strong></p>
        <label class="toggle">
          <input type="checkbox" id="soundToggle" checked>
          <span class="slider"></span>
          <span class="toggle-label">Sonidos de ingreso</span>
        </label>
        <label class="toggle">
          <input type="checkbox" id="animationsToggle" checked>
          <span class="slider"></span>
          <span class="toggle-label">Animaciones</span>
        </label>
      </div>
      <div class="form-card">
        <h3>Reseteo r√°pido</h3>
        <div class="button-row">
          <button type="button" id="resetAll" class="ghost danger">Borrar todo</button>
          <button type="button" id="resetExpenses" class="ghost danger">Borrar gastos</button>
          <button type="button" id="resetIncomes" class="ghost">Borrar ingresos</button>
          <button type="button" id="resetExpenseCategories" class="ghost">Borrar categor√≠as de gastos</button>
          <button type="button" id="resetIncomeCategories" class="ghost">Borrar categor√≠as de ingresos</button>
        </div>
        <p class="muted">Las acciones piden confirmaci√≥n para evitar borrados accidentales.</p>
      </div>

      <div class="form-card">
        <h3>Backup y restauraci√≥n</h3>
        <p class="muted">Descarg√° un backup de tus datos o restauralo cuando lo necesites.</p>
        <p id="lastBackupInfo" class="muted backup-status"></p>
        <div class="button-row">
          <button type="button" id="downloadBackup">Descargar backup</button>
          <label class="file-label">
            <input type="file" id="restoreFile" accept="application/json" class="hidden">
            <span class="ghost">Restaurar backup</span>
          </label>
        </div>
        <textarea id="backupPreview" rows="4" readonly placeholder="Ac√° vas a ver un resumen del backup generado"></textarea>
      </div>
    </section>
  </main>

  <footer>
    <p id="footerText"></p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
